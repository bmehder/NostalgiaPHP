<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Understanding index.php in NostalgiaPHP — NostalgiaPHP</title>

      <meta name="description" content="A guided tour of the tiny front controller that routes requests, loads content, and renders templates.">
  
  <link rel="canonical" href="http://localhost/">

  <!-- Favicon core -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png">
  <link rel="manifest" href="/static/favicons/site.webmanifest">
  <link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#000000">
  <link rel="shortcut icon" href="/static/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-config" content="/static/favicons/browserconfig.xml">
  <meta name="theme-color" content="#000000">

  
  <!-- Open Graph (basic) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Understanding index.php in NostalgiaPHP">
      <meta property="og:description" content="A guided tour of the tiny front controller that routes requests, loads content, and renders templates.">
    <meta property="og:url" content="http://localhost/">
  
  <!-- Useful for client scripts that need the base URL -->
  <meta name="base-url" content="">

  <!-- Apply saved theme class before CSS loads to prevent flash of default skin -->
  <script>
    (function () {
      try {
        const theme = localStorage.getItem('nostalgia:theme');
        if (theme) document.documentElement.classList.add(theme);
      } catch (_) { }
    })();
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/css/colors.css">
  <link rel="stylesheet" href="/static/css/reboot.css">
  <link rel="stylesheet" href="/static/css/skins.css">
  <link rel="stylesheet" href="/static/css/utilities.css">
  <link rel="stylesheet" href="/static/css/components.css">

  <!-- Google Font (consider self-hosting for perf/privacy) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@600..900&display=swap" rel="stylesheet">

  <!-- Prism (non-blocking) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-okaidia.min.css" media="print"
    onload="this.media='all'">
  <noscript>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-okaidia.min.css">
  </noscript>

  <script>
    // Configure autoloader path before plugin loads
    window.Prism = window.Prism || {};
    Prism.plugins = Prism.plugins || {};
    Prism.plugins.autoloader = { languages_path: "https://cdn.jsdelivr.net/npm/prismjs/components/" };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.css" media="print"
    onload="this.media='all'">

  <!-- Theme Switcher -->
  <script type="module" src="/static/js/apps/theme-switcher.js"></script>

  <!-- Appear.js -->
  <script type="module" src="/static/js/apps/appear.js"></script>
</head>
<body class="layout-sidebar">
  <div class="wrapper">
    <a class="visually-hidden" id="top"></a>

<header>
  <a href="#main" class="skip-link">Skip to main content</a>
  <div class="outer">
    <div class="inner spread-apart" data-inner-header>
      <!-- <a class="brand" href="/">NostalgiaPHP</a> -->

      <a class="brand flex align-items-center gap-0-5" href="/">
        <!-- NostalgiaPHP mark -->
        <svg aria-label="NostalgiaPHP" width="28" height="28" viewBox="0 0 24 24" fill="var(--accent-strong)">
          <rect x="2.25" y="2.25" width="19.5" height="19.5" rx="6" stroke="currentColor" stroke-width="1.5" />
          <!-- Single-stroke 'N' -->
          <path d="M7 16V8L17 16V8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
        NostalgiaPHP      </a>

      <!-- ✅ hidden control for JS-less toggle -->
      <input type="checkbox" id="nav-check" class="nav-check" aria-label="Toggle menu" tabindex="-1">

      <!-- ✅ label becomes the hamburger button -->
      <label for="nav-check" class="nav-toggle" aria-controls="site-nav">
        <span class="visually-hidden">Menu</span>
        <svg viewBox="0 0 24 24" width="40" height="40" fill="var(--text-inverse)" aria-hidden="true">
          <rect x="3" y="6" width="18" height="2" rx="1"></rect>
          <rect x="3" y="11" width="18" height="2" rx="1"></rect>
          <rect x="3" y="16" width="18" height="2" rx="1"></rect>
        </svg>
      </label>

      <nav id="site-nav" data-site-nav class="nav spread-apart"><a href="/" class="">Home</a><div class="has-submenu"><a href="/about" class="top-link " anchor-name="--parent-nav-item">About</a><ul class="submenu list-style-none flow-0-5"><li><a href="/about/components" class="">Components</a></li><li><a href="/about/blink" class="">Blink</a></li><li><a href="/about/fetch" class="">Fetch</a></li><li><a href="/about/slider" class="">Slider</a></li><li><a href="/api" class="">REST API</a></li></ul></div><a href="/blog" class="">Blog</a><a href="/dox" class="">Dox</a><a href="/search" class="">Search</a><a href="/contact" class="">Contact</a><div class="has-submenu"><a href="/admin" class="top-link " anchor-name="--parent-nav-item">Admin</a><ul class="submenu list-style-none flow-0-5"><li><a href="/sitemap.xml" class="">Sitemap</a></li><li><a href="/robots.txt" class="">Robots</a></li></ul></div><a href="https://github.com/bmehder/NostalgiaPHP" class="github-link border-none" style="line-height:0" target="_blank" rel="noopener">  <svg viewBox="0 0 16 16" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M8 .2a8 8 0 0 0-2.5 15.6c.4.1.6-.2.6-.4v-1.4c-2.5.5-3-1.2-3-1.2-.3-.9-.8-1.2-.8-1.2-.7-.5.1-.5.1-.5.8.1 1.2.8 1.2.8.7 1.2 1.9.9 2.4.7.1-.5.3-.9.5-1.1-2-.2-4.1-1-4.1-4.3 0-1 .4-1.9 1-2.6-.1-.2-.4-1.1.1-2.3 0 0 .8-.2 2.6 1a9 9 0 0 1 4.7 0c1.8-1.2 2.6-1 2.6-1 .5 1.2.2 2.1.1 2.3.7.7 1 1.6 1 2.6 0 3.3-2.1 4-4.1 4.3.3.2.5.6.5 1.3v1.9c0 .2.2.5.6.4A8 8 0 0 0 8 .2Z"/></svg>  <span class="visually-hidden">GitHub</span></a></nav>    </div>
  </div>
</header>        <main id="main">
        <nav class="breadcrumbs inner" aria-label="Breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
    <ol>
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="/"><span itemprop="name">Home</span></a>
        <meta itemprop="position" content="1">
      </li>
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="/dox">
          <span itemprop="name">Dox</span>
        </a>
        <meta itemprop="position" content="2">
      </li>
      <li aria-current="page" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span itemprop="name">Understanding index.php in NostalgiaPHP</span>
        <meta itemprop="position" content="3">
      </li>
    </ol>
  </nav>
        <div class="outer">
                  <div class="inner" style="--inner-padding-block: var(--size-1-5)">
                      <div class="content content-sidebar">
              <div>
                                  <div class="post-meta">
                    <time datetime="2025-09-20T00:00:00+01:00">Sep 20, 2025</time>                  </div>
                                <section class="content flow">
                  <h1>Understanding index.php</h1>
<p>In NostalgiaPHP, index.php is the front controller—the single entry point that receives every request, figures out what the user wants, loads content, and renders the right template. This post walks through the core flow so you can extend it with confidence.</p>
<hr />
<h2>1. Normalize the request path</h2>
<pre><code class="language-php">$path  = request_path();  // '/', '/about', '/blog/hello-world'
$parts = $path === '/' ? [] : explode('/', ltrim($path, '/'));
$first = $parts[0] ?? '';</code></pre>
<ul>
<li><code>request_path()</code> strips the domain and query string.</li>
<li>Home becomes [] for simpler branching.</li>
<li><code>$first</code> is the key decision point (e.g., blog, about).</li>
</ul>
<p><em>Tip: Keep this logic tiny and readable—most routing bugs start here.</em></p>
<hr />
<h2>2. Handle special routes (system endpoints)</h2>
<p>Examples: <code>robots.txt</code>, <code>sitemap.xml</code>, <code>admin</code>.</p>
<pre><code class="language-php">if ($path === '/robots.txt') {
  require __DIR__ . '/routes/robots.php';
  exit;
}

if ($path === '/sitemap.xml') {
  require __DIR__.'/sitemap.php';
  exit;
}

if ($path === '/admin') {
  // require __DIR__.'/auth/guard.php'; require_login();
  require __DIR__.'/admin.php';
  exit;
}</code></pre>
<p>These bypass the normal content lookup entirely and loads the <code>admin.php</code> route.</p>
<hr />
<h2>3. Tag routes (cross-collection)</h2>
<p>Two tiny routes enable a global tag system:</p>
<p>a. <code>/tags</code> — list all tags with counts</p>
<pre><code class="language-php">if ($path === '/tags') {
  require __DIR__ . '/routes/tags.php';
  exit;
}</code></pre>
<p>b. <code>/tag/{slug}</code> — list items with a given tag</p>
<pre><code class="language-php">if ($first === 'tag' &amp;&amp; isset($parts[1])) {
  require __DIR__ . '/routes/tag.php';
  exit;
}</code></pre>
<p>These run before the collection/page branches.</p>
<p>They scan <code>content/collections/*.md</code> and <code>content/pages/*.md</code>, parse front matter, and match tags (or tag/keywords) case-insensitively.</p>
<p>Rendering is intentionally minimal (a simple list), so you can swap it for cards later without touching the router.</p>
<p>The <code>tags.php</code> or <code>tag.php</code> route is loaded.</p>
<hr />
<h2>4. Collection routes (/collection/slug)</h2>
<pre><code class="language-php">if (is_collection($first)) {
  require __DIR__ . '/routes/collections.php';
  exit;
}</code></pre>
<p>If <code>$first</code> is a collection in the <code>config.php</code> file → load the <code>collections.php</code> route.</p>
<hr />
<h2>5. Page routes (/, /about, /about/blink)</h2>
<pre><code class="language-php">require __DIR__ . '/routes/pages.php';</code></pre>
<p>If no other routes match, assume it is a page and load the <code>pages.php</code> route.</p>
<hr />
<h2>6. 404 fallback</h2>
<pre><code class="language-php">http_response_code(404);
render('main', [
  'title'   =&gt; 'Not Found',
  'content' =&gt; '&lt;h1&gt;404&lt;/h1&gt;&lt;p&gt;Page not found.&lt;/p&gt;',
  'path'    =&gt; $path,
]);</code></pre>
<p>Each route will return a 404 page if the content is not fount.</p>
<hr />
<h2>Design notes</h2>
<ul>
<li>Small surface area: The router is just branching logic + a few helpers. No classes, no framework.</li>
<li>Predictable structure: Pages live in <code>content/pages</code>, collections in <code>content/collections/{name}</code>.</li>
<li>Pluggable views: Index pages use partials (<code>cards-grid.php</code>, <code>items-list.php</code>) so theme changes don’t touch routing.</li>
<li>Security: Always run slugs through <code>sanitize_rel_path()</code> before hitting the filesystem.</li>
</ul>
<hr />
<h2>TL;DR</h2>
<p><code>index.php</code> is intentionally tiny. It:</p>
<ol>
<li>Parses the path</li>
<li>Short-circuits special routes</li>
<li>Then tries collection</li>
<li>Then tries home</li>
<li>Falls back to a 404 page</li>
</ol>
<p>This clarity is the whole point of NostalgiaPHP: a site is just folders and files wired together with a few small functions.</p>                </section>
                                                                        <hr />
                    <h3>Tagged:</h3>
                    <ul class="tags">
      <li><a href="/tag/php">php</a></li>
      <li><a href="/tag/simplicity">simplicity</a></li>
      <li><a href="/tag/retro">retro</a></li>
  </ul>                                                </div>
              
<aside class="sidebar flow">
  <h2>Explore</h2>

  <search>
  <form class="search-form flex" method="get" action="/search" role="search">
    <label class="visually-hidden" for="q">Search</label>
    <input id="q" class="flex" type="search" name="q" value="" placeholder="Search this site…"
      autocomplete="off" />
    <button type="submit" class="margin-0">Search</button>
  </form>
</search>
  <h3>Recent Items</h3>
  <ul>
            <li>
          <a href="/blog/not-nostalgia-php">You Might Not Want to Use NostalgiaPHP</a><br />
          <small>2025-10-08</small>
        </li>
              <li>
          <a href="/dox/understanding-the-styles">Understanding the Styles</a><br />
          <small>2025-10-05</small>
        </li>
              <li>
          <a href="/blog/appear-animations">Appear Animations</a><br />
          <small>2025-10-02</small>
        </li>
              <li>
          <a href="/dox/nostalgia-php-cli">Nosty CLI — Your New Best Friend</a><br />
          <small>2025-09-28</small>
        </li>
              <li>
          <a href="/dox/api-routes">Introducing the NostalgiaPHP REST API</a><br />
          <small>2025-09-27</small>
        </li>
        </ul>
  <!-- ——— TAGS (simple list) ——— -->
  
  <section class="sidebar-section">
    <h3 class="sidebar-heading">Tags</h3>
          <ul class="tags-list">
                  <li>
            <a href="/tag/animation">
              animation            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/api">
              api            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/blink">
              blink            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/css">
              css            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/intersectionobserver">
              intersectionobserver            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/js">
              js            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/json">
              json            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/nostalgia">
              nostalgia            </a>
            <small>(2)</small>
          </li>
                  <li>
            <a href="/tag/php">
              php            </a>
            <small>(3)</small>
          </li>
                  <li>
            <a href="/tag/reactivity">
              reactivity            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/rest">
              rest            </a>
            <small>(1)</small>
          </li>
                  <li>
            <a href="/tag/retro">
              retro            </a>
            <small>(3)</small>
          </li>
                  <li>
            <a href="/tag/simplicity">
              simplicity            </a>
            <small>(3)</small>
          </li>
                  <li>
            <a href="/tag/slank">
              slank            </a>
            <small>(1)</small>
          </li>
              </ul>
      <!-- <p class="tag-cloud-more"><a href="/tags">View all tags →</a></p> -->
      </section>
</aside>            </div>
          </div>
        </div>
    </main>
    <footer>
  <div class="outer">
    <div class="inner">
      <div class="content spread-apart">
        &copy; 2025 NostalgiaPHP. All rights reserved.
        <a href="#top" data-back-to-top>⬆ Back to Top</a>
        <script>
          document.addEventListener('DOMContentLoaded', () => {

            document.querySelector('[data-back-to-top]').addEventListener('click', e => {
              e.preventDefault()
              window.scrollTo({ top: 0 })
            })
          })
        </script>
      </div>
    </div>
  </div>
</footer>

</body>

</html>  </div>